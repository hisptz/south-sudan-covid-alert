<mat-tab-group (selectedTabChange)="eventToShow = null">
  <mat-tab label="All Registered">
    <div class="container-fluid px-0">
      <div class="row mx-0 w-100">
        <!-- Search field with buttons -->
        <div class="row w-100 mx-0 mb-2">
          <div class="col-sm">
            <div class="input-group">
              <mat-form-field class="w-25" appearance="outline">
                <input
                  matInput
                  type="text"
                  placeholder="Search"
                  (keyup)="searchingItems($event)"
                />
              </mat-form-field>
            </div>
          </div>
        </div>
        <!-- Search field with buttons -->
        <!-- {{eventsAnalytics$ | async | json }} -->

        <!-- Progressive Loader -->
        <mat-progress-bar
          mode="indeterminate"
          class="ml-2"
          *ngIf="eventsLoading$ | async"
        ></mat-progress-bar>
        <!-- End of Progressive Loader -->

        <!-- Table card section  -->
        <div
          class="ml-2"
          [ngClass]="{ 'table-section': eventToShow, 'w-100': !eventToShow }"
          *ngIf="eventsAnalytics$ | async"
        >
          <mat-card class="w-100 mb-4 p-0 overflow-hidden">
            <div class="table-responsive"  [ngClass]="{ 'overflow-hidden': !eventToShow}">
              <table class="table table-bordered w-100">
                <thead>
                  <tr class="text-muted">
                    <th>SN</th>
                    <th *ngFor="let header of allRegisteredHeaders">
                      {{ header?.column }}
                    </th>
                    <th>State</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody *ngIf="eventsAnalytics$ | async as eventAnalytics">
                  <tr
                    *ngFor="
                      let row of eventAnalytics
                        | filterBy: allRegisteredFilters:searchText
                        | paginate
                          : { itemsPerPage: itemsPerPage, currentPage: page };
                      let i = index;
                      trackBy: trackByFn
                    "
                  >
                    <td>{{ i + 10 * (page - 1) + 1 }}</td>
                    <td *ngFor="let header of allRegisteredHeaders">
                      <button
                        mat-button
                        *ngIf="header?.name === commonIds.CALLER_NAME"
                        (click)="showEventData(row)"
                      >
                        {{ row[header?.name] }}
                      </button>
                      <p *ngIf="header?.name !== commonIds.CALLER_NAME">
                        {{
                          header.valueType === 'DATE'
                            ? (row[header?.name] | date)
                            : row[header?.name]
                        }}
                      </p>
                    </td>
                    <td>{{ row?.orgUnitAncestors?.state}}</td>

                    <td>
                      <button
                        mat-stroked-button
                        color="primary"
                        class="mt-2 ml-2 button-height"
                        *ngIf="
                          row[reportedToRRTId] !== 'Yes' &&
                          !row.isReportToRRTPending
                        "
                        (click)="updateReportToRRT(row)"
                      >
                        Report to RRT
                      </button>
                    </td>
                  </tr>
                </tbody>
                <tbody
                  *ngIf="
                    (
                      eventsAnalytics$
                      | async
                      | filterBy: allRegisteredFilters:searchText
                    )?.length < 1 && (eventsAnalytics$ | async)?.length > 0
                  "
                >
                  <tr>
                    <td colspan="10">
                      <label class="text-muted text-center w-100 h3">
                        Session not found</label
                      >
                    </td>
                  </tr>
                </tbody>
                <tfoot
                  *ngIf="
                    (
                      eventsAnalytics$
                      | async
                      | filterBy: allRegisteredFilters:searchText
                    )?.length > 0
                  "
                >
                  <tr>
                    <td [attr.colspan]="14">
                      <app-pagination
                        [itemsPerPage]="itemsPerPage"
                        [pageInterval]="itemsPerPage"
                        [pageIntervalFactor]="1"
                        [currentPage]="page"
                        [dataArray]="eventsAnalytics$ | async"
                        [maxSize]="(eventsAnalytics$ | async).length"
                        (changeCurrentPage)="onCurrentPageUpdate($event)"
                        (updateItemsPerPage)="onUpdatePageSize($event)"
                      >
                      </app-pagination>
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </mat-card>
        </div>
        <!-- End of Table card section  -->
        <div class="info-section mr-2 ml-4" *ngIf="eventToShow">
          <app-view-event
            [event]="eventToShow"
            [headers]="allHeaders"
            (closeEvent)="closeEventDataSection($event)"
          ></app-view-event>
        </div>
      </div>
    </div>
  </mat-tab>

  <mat-tab class="overflow-hidden" label="Reported to RRT">
    <div class="container-fluid px-0">
      <div class="row mx-0 w-100">
        <!-- Search field with buttons -->
        <div class="row w-100 mx-0 mb-2">
          <div class="col-sm">
            <div class="input-group">
              <mat-form-field class="w-25" appearance="outline">
                <input
                  matInput
                  type="text"
                  placeholder="Search"
                  (keyup)="searchingItems($event)"
                />
              </mat-form-field>
            </div>
          </div>
        </div>
        <!-- Search field with buttons -->
        <!-- {{eventsAnalytics$ | async | json }} -->

        <!-- Progressive Loader -->
        <mat-progress-bar
          mode="indeterminate"
          class="ml-2"
          *ngIf="eventsLoading$ | async"
        ></mat-progress-bar>
        <!-- End of Progressive Loader -->

        <!-- Table card section  -->
        <div
          class="row w-100 ml-2 overflow-hidden"
          [ngClass]="{ 'table-section': eventToShow, 'w-100': !eventToShow }"
          *ngIf="eventsAnalytics$ | async"
        >
          <mat-card class="w-100 mb-4 p-0 overflow-hidden">
            <table class="table table-bordered overflow-hidden">
              <thead>
                <tr class="text-muted">
                  <th>SN</th>
                  <th *ngFor="let header of reportedToRRTHeaders">
                    {{ header?.column }}
                  </th>
                </tr>
              </thead>
              <tbody *ngIf="eventsAnalytics$ | async as eventAnalytics">
                <tr
                  *ngFor="
                    let row of getEventsWithCallerMeetCase(eventAnalytics)
                      | filterBy: reportedToRRTFilters:searchText
                      | paginate
                        : { itemsPerPage: itemsPerPage, currentPage: page };
                    let i = index
                  "
                >
                  <td>{{ i + 10 * (page - 1) + 1 }}</td>
                  <td *ngFor="let header of reportedToRRTHeaders">
                    <button
                      mat-button
                      *ngIf="header?.name === commonIds.CALLER_NAME"
                      (click)="showEventData(row)"
                    >
                      {{ row[header?.name] }}
                    </button>
                    <p *ngIf="header?.name !== commonIds.CALLER_NAME">
                      {{
                        header.valueType === 'DATE'
                          ? (row[header?.name] | date)
                          : row[header?.name]
                      }}
                    </p>
                  </td>
                </tr>
              </tbody>
              <tbody
                *ngIf="
                  (
                    eventsAnalytics$
                    | async
                    | filterBy: reportedToRRTFilters:searchText
                  )?.length < 1 && (eventsAnalytics$ | async)?.length > 0
                "
              >
                <tr>
                  <td colspan="10">
                    <label class="text-muted text-center w-100 h3">
                      Session not found</label
                    >
                  </td>
                </tr>
              </tbody>
              <tfoot
                *ngIf="
                  (
                    eventsAnalytics$
                    | async
                    | filterBy: reportedToRRTFilters:searchText
                  )?.length > 0
                "
              >
                <tr>
                  <td [attr.colspan]="13">
                    <app-pagination
                      [itemsPerPage]="itemsPerPage"
                      [pageInterval]="itemsPerPage"
                      [pageIntervalFactor]="1"
                      [currentPage]="page"
                      [dataArray]="eventsAnalytics$ | async"
                      [maxSize]="(eventsAnalytics$ | async)?.length"
                      (changeCurrentPage)="onCurrentPageUpdate($event)"
                      (updateItemsPerPage)="onUpdatePageSize($event)"
                    >
                    </app-pagination>
                  </td>
                </tr>
              </tfoot>
            </table>
          </mat-card>
        </div>
        <!-- End of Table card section  -->
        <div class="info-section mr-2 ml-4" *ngIf="eventToShow">
          <app-view-event
            [event]="eventToShow"
            [headers]="reportedToRRTHeaders"
            (closeEvent)="closeEventDataSection($event)"
          ></app-view-event>
        </div>
      </div>
    </div>
  </mat-tab>
</mat-tab-group>
